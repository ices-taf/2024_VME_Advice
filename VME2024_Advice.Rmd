---
title: "Advice on areas where Vulnerable Marine Ecosystems (VMEs) are known to occur or are likely to occur in EU waters <img src=\"Utilities/iceslogo.png\" style=\"float: right;\"/>"
author: "ICES"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
chunk_output_type: console
#runtime: shiny
editor_options: 
  chunk_output_type: console
---
<style>
.html-widget {
    margin: auto;

}
</style>


<style type="text/css">
  body{
  font-size: 11pt;
  font-family: times, serif;
  text-align: justify;
  }
  table,td,th {
    font-size: 10pt;
    font-family: times, serif;
  }
  a {
    color: #6FA388;
    text-decoration: none;
    font-weight: bold;
  }
  .nav-pills>li.active>a, .nav-pills>li.active>a:focus, .nav-pills>li.active>a:hover {
    color: #fff;
    background-color: #6FA388;
  }
  .roman {
    list-style-type: lower-roman;
  }
  .square {
    list-style-type: square;
    margin-left: -2em;
  } 

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
options(knitr.duplicate.label = "allow")
options(knitr.kable.NA = '')
sf::sf_use_s2(FALSE)

  pathdir       <- getwd()
  icespal       <- c('#939DBD','#012B5B','#7FA99C')
  names(icespal)<- c('lb','db','lg')
    
  source(paste(pathdir,"Utilities/Libraries_VMEadvice.R",sep="/"))  

  # load all data layers for rmarkdown (including the datacall year)
  load(paste(pathdir,"2-Data processing/Map_layers_workspace.RData",sep="/")) 
  
  # if you load workspace from other "user" update pathdir
  pathdir       <- getwd()
  
  # add the publication year of the previous ICES advice
  PubYearPrevAdvice <- 2023
  
  # set the most recent fishing years
  newyear_fished <- (datacallyear_VMS-1):(datacallyear_VMS-3)

  # Load text for map layer description and table with scenario text
  map2layers <- openxlsx::read.xlsx(paste(pathdir,"Output/MapLayerDesc.xlsx",sep="/"),4)
  scenop     <- openxlsx::read.xlsx(paste(pathdir,"Output/ScenarioOptions.xlsx",sep="/"),2)

  # Load source data used for table 1
  load(paste(pathdir,"2-Data processing/Table1_underlyingdata.RData",sep="/"))
  
  # Load EUVME text
  textreg   <- openxlsx::read.xlsx(paste(pathdir,"Output/Text_EUVME.xlsx",sep="/"), 2)
```

#  {.tabset .tabset-fade .tabset-pills}
## General information {.tabset}
```{r , results = 'asis'}
tt <- subset(textreg,textreg$Tab == "Overview")
cat(tt[1,3])
```

### Scenarios (Table 1)
```{r , results = 'asis'}
tt <- subset(textreg,textreg$Tab == "Scenario options")
for(i in 1:nrow(tt)){
  cat(tt[i,3])
  }
```
```{r }

scenop %>%
  kbl('html',escape = FALSE, align='l',col.names = c('Scenario',
                                                     'Description of VME polygons',
                                                     'Interpretation')) %>%
  kable_classic(full_width = F, position = "center",fixed_thead = T,font_size = 10,html_font = "Times") %>%
  row_spec(0, bold = T)  %>%
  row_spec(0:nrow(scenop), extra_css = 'padding: 10px;vertical-align:top;') %>%
  column_spec(1, width = "2.5cm") %>%
  column_spec(2, width = "12cm") %>%
  column_spec(3, width = "12cm")%>%
    kable_styling(bootstrap_options = c("hover"))

```
### Key to map layers (Table 2) 
```{r , results = 'asis'}
tt <- subset(textreg,textreg$Tab == "Key to map layers")
if(!(is.na(tt$Text))){
for(i in 1:nrow(tt)){
  cat(tt[i,3])
  }}
```
```{r map2 key}
#map2layers <- map2layers[-c(1,4,15,16),] 
#map2layers[,-2] 
map2layers[,-2]  %>%
  kbl('html',escape = FALSE, align='l',row.names=F,col.names = c('Layer','Description')) %>%
  kable_classic(full_width = F, position = "center",fixed_thead = T,font_size = 10,html_font = "Times") %>%
  row_spec(0, bold = T)  %>%
  row_spec(0:nrow(map2layers), extra_css = 'padding: 10px;vertical-align:top;') %>%
  column_spec(1, width = "6.5cm") %>%
  column_spec(2, width = "15cm")%>%
    kable_styling(bootstrap_options = c("hover"))

```
### References
```{r , results = 'asis'}
tt <- subset(textreg,textreg$Tab == "References")
cat(tt[1,3])

```


## Celtic Seas {.tabset}
```{r CS,include=FALSE}
  Region_ID <- "Celtic Seas"
  Region_ID_Excel <- "Celtic Seas"
```

```{r add-to-main, child = paste0(pathdir,'/Utilities/10. VME2024_advice_assessarea.Rmd')}
```

## Bay of Biscay and the Iberian Coast {.tabset}
```{r BoBIC,include=FALSE}
  Region_ID <- "Bay of Biscay and the Iberian Coast"
  Region_ID_Excel <- "BoBIC"
```

```{r add-to-main, child = paste0(pathdir,'/Utilities/10. VME2024_advice_assessarea.Rmd')}
```

# {-}